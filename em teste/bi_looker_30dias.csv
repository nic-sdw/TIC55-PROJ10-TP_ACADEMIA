import pandas as pd
import matplotlib.pyplot as plt
import seaborn as sns

def gerar_graficos_teste():
    print("--- üìä GERANDO GR√ÅFICOS DE TESTE ---")
    
    try:
        # 1. Carregar os dados gerados no script anterior
        df = pd.read_csv("bi_looker_30dias.csv", sep=';', encoding='utf-8-sig')
        
        # Configura√ß√£o visual do Seaborn
        sns.set_theme(style="whitegrid")
        plt.rcParams['figure.figsize'] = [10, 6]

        # --- GR√ÅFICO 1: Distribui√ß√£o por Faixa Et√°ria ---
        plt.figure()
        ordem_faixas = ['0-17', '18-25', '26-35', '36-45', '46-60', '60+']
        sns.countplot(data=df, x='FAIXA_ETARIA', order=ordem_faixas, palette='viridis')
        plt.title('Distribui√ß√£o de Novos Alunos por Faixa Et√°ria (30 dias)')
        plt.xlabel('Faixa Et√°ria')
        plt.ylabel('Quantidade de Alunos')
        plt.savefig('grafico_idade_teste.png')
        print("   > [OK] Gr√°fico de Idade gerado: grafico_idade_teste.png")

        # --- GR√ÅFICO 2: Perfil de G√™nero (Sexo) ---
        plt.figure()
        df['SEXO'].value_counts().plot.pie(autopct='%1.1f%%', startangle=140, colors=['#ff9999','#66b3ff'])
        plt.title('Propor√ß√£o Masculino vs Feminino')
        plt.ylabel('') # Remove o label do eixo Y
        plt.savefig('grafico_sexo_teste.png')
        print("   > [OK] Gr√°fico de Sexo gerado: grafico_sexo_teste.png")

        # --- GR√ÅFICO 3: Status de Desist√™ncia (Churn) ---
        plt.figure()
        sns.countplot(data=df, x='DESISTENTE', palette='magma')
        plt.title('Indicador de Desist√™ncia (Churn Preventivo)')
        plt.xlabel('Desistente (Sim/N√£o)')
        plt.ylabel('Quantidade')
        plt.savefig('grafico_desistencia_teste.png')
        print("   > [OK] Gr√°fico de Desist√™ncia gerado: grafico_desistencia_teste.png")

        print("\n‚úÖ Todos os gr√°ficos foram salvos na sua pasta de teste!")

    except FileNotFoundError:
        print("‚ùå Erro: O arquivo 'bi_looker_30dias.csv' n√£o foi encontrado.")
    except Exception as e:
        print(f"‚ùå Ocorreu um erro: {e}")

if __name__ == "__main__":
    gerar_graficos_teste()